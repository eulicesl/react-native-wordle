# Phase 1B: Foundation Systems

Build the core systems that Phase 2 features depend on: sound engine, haptic vocabulary, typography system, dark mode enhancement, and spacing constants.

## Prerequisites

Phase 1A (critical fixes) must be completed first. All animations now use Reanimated. All setTimeout calls have cleanup.

## Context

- Sound system: `src/utils/sounds.ts` (has Web Audio API synthesis but native plays a base64 beep stub)
- Haptics: `src/utils/haptics.ts` (functional but single-pattern for most events)
- Theme: `src/theme.ts` (light/dark themes defined)
- Constants: `src/utils/constants.ts` (colors, SIZE)
- Responsive: `src/utils/responsive.ts` (breakpoints, scaling functions)
- Animations: `src/utils/animations.ts` (timing constants)
- Settings: `src/store/slices/settingsSlice.ts`
- Settings screen: `src/screens/settings/index.tsx`

## Tasks

- [ ] F1.6a: Implement native sound engine with synthesized tones. The current native sound implementation in src/utils/sounds.ts (playNativeSound, lines 302-322) plays a hardcoded base64 WAV beep for all sound types. Replace this with a proper implementation that generates different tones for each SoundType. The PROFESSIONAL_SOUNDS config (lines 69-156) already defines musical notes, durations, and envelope parameters for each sound type. Implement a native sound synthesis approach: for each sound type, generate a WAV buffer programmatically using the note frequencies from semitoneToFreq() and the ADSR envelope parameters. Cache the generated Audio.Sound instances in the soundCache Map so they only need to be created once. The playNativeSound function should: 1) check if the sound is cached, 2) if not, generate and cache it, 3) play the cached sound with proper volume. Add a preloadAllSounds() function that generates and caches all sound types on app startup. Call preloadAllSounds() from initializeAudio(). Each sound must be distinct and recognizable. Test by toggling sounds in settings and verifying different tones play for key press, tile flip correct/present/absent, win, and error.

- [ ] F1.6b: Add win tier sounds and connect sound system to game events. Extend the SoundType in src/utils/sounds.ts to include 'winTier1' through 'winTier6' for graduated win celebrations. Tier 1 (genius, guess 1) should be the most elaborate - use the existing 'win' notes plus extra triumphant notes. Tier 6 (phew, guess 6) should be a simple relieved resolution. Define PROFESSIONAL_SOUNDS entries for each tier with decreasing complexity. In src/screens/game/index.tsx, update the win logic (inside the setTimeout at line 397) to call playSound with the appropriate tier based on guessCount: playSound(`winTier${guessCount}` as SoundType). Also ensure playVictorySound in sounds.ts uses the tier. Update the SoundType type union to include the new types. Add a test in src/__tests__/ that verifies all SoundType values are defined in PROFESSIONAL_SOUNDS.

- [ ] F1.7: Enhance haptic vocabulary with distinct patterns per game event. The current haptics in src/utils/haptics.ts already have correct/present/absent differentiation (lines 53-63) but the patterns could be more distinct. Update the haptic patterns to: keyPress=impactLight, keyDelete=selectionAsync (different from letter press), submit=impactMedium, correct=notificationSuccess, present=impactMedium, absent=impactLight (the lightest to feel like "nothing"), win=ascending triple impact (impactLight→pause 100ms→impactMedium→pause 100ms→impactHeavy), lose=single notificationWarning, error=notificationError. Also add new haptic types: 'streakMilestone' (double notificationSuccess with 200ms gap), 'achievementUnlock' (notificationSuccess), 'toggle' (selectionAsync for settings toggles). Update the HapticType union type. Connect the new 'toggle' haptic to all Switch toggles in src/screens/settings/index.tsx by calling playHaptic('toggle') in each toggle handler. Write a test that verifies all HapticType values have a case in the switch statement.

- [ ] F1.8: Create typography system constants. Create a new file src/utils/typography.ts that exports a typography scale object and helper functions. Define named text styles: display (Montserrat_800ExtraBold, 36pt), heading1 (Montserrat_700Bold, 26pt), heading2 (Montserrat_700Bold, 20pt), heading3 (Montserrat_700Bold, 17pt), body (Montserrat_600SemiBold, 15pt, lineHeight 22), bodySmall (Montserrat_600SemiBold, 13pt, lineHeight 18), statNumber (Montserrat_800ExtraBold, 32pt). Export as a StyleSheet-compatible object so screens can use `typography.heading1` etc. Add a helper `dynamicText(style, maxScale?)` that wraps any typography style with dynamicFontSize() from responsive.ts. Update the Statistics screen title (line 329, currently fontSize 24) to use typography.heading1. Update the Settings screen section headers to use typography.bodySmall with uppercase and letterSpacing. Update the Help screen title to use typography.heading1. This establishes the pattern for all future screen work.

- [ ] F1.9: Enhance dark mode with OLED true black and depth layers. Update src/theme.ts DarkTheme to use true black (#000000) as the main background instead of #1A1A2E. Create a layered elevation system: background=#000000, surface1=#0D0D1A (tab bar, status areas), surface2=#1A1A2E (cards, modals - current background2 value), surface3=#252542 (interactive elements like keyboard keys). Update the DarkTheme colors object: background='#000000', background2='#1A1A2E', background3='#252542'. Add a new color 'surface1' with value '#0D0D1A'. Update src/navigation/mainNavigator.tsx tab bar background to use theme.colors.surface1 (or background2 if surface1 is not in the type) when in dark mode. Update the game screen background in src/screens/game/index.tsx and gameBoard.tsx to use theme.colors.background. The key visual change: on OLED screens, the background pixels will be completely off, making the game tiles and keyboard appear to float. Update src/utils/constants.ts `colors.bg` from '#1A1A2E' to '#000000'. Test that all screens look correct in both dark and light modes. Ensure text contrast ratios remain above 4.5:1.

- [ ] F1.10: Create spacing constants and apply to key screens. Create a new file src/utils/spacing.ts that exports spacing scale values based on a 4px grid: space1=4, space2=8, space3=12, space4=16, space5=20, space6=24, space8=32, space10=40, space12=48, space16=64. Also export a `spacing` object with semantic names: xs=4, sm=8, md=16, lg=24, xl=32, xxl=48. Apply the spacing constants to the Game screen (src/screens/game/index.tsx): replace hardcoded padding 20 (line 719) with spacing.md (16), replace margin values. Apply to Statistics screen: replace padding 20 (line 639) with spacing.md, marginBottom 24 (line 644) with spacing.lg. Apply to Settings screen: replace hardcoded padding and margin values. The goal is not to change the visual appearance dramatically but to standardize the spacing vocabulary for consistency. Export all constants as named exports for tree-shaking.
